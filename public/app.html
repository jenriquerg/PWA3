<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Task Manager — App</title>
  <meta name="description" content="Aplicación de gestión de tareas con funcionalidad offline">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0b74de">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <style>
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,sans-serif;margin:0;padding:12px;background:#f6fbff;color:#1a1a1a}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px}
    header h1{margin:0;font-size:1.5rem;color:#0b74de}
    .header-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{padding:8px 16px;border-radius:8px;border:none;background:#0b74de;color:white;cursor:pointer;font-size:0.9rem;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
    .btn:hover{background:#0a5cb8;transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn:disabled{opacity:0.5;cursor:not-allowed}
    .btn-secondary{background:#6c757d}
    .btn-secondary:hover{background:#5a6268}
    .btn-success{background:#28a745}
    .btn-success:hover{background:#218838}
    .btn-small{padding:6px 12px;font-size:0.85rem}
    .link{color:#0b74de;text-decoration:none;padding:8px 12px;border-radius:6px;background:#e8f4ff;font-size:0.9rem}
    .link:hover{background:#d0e9ff}
    .card{background:white;padding:16px;border-radius:12px;box-shadow:0 2px 8px rgba(11,116,222,0.08);margin:12px 0}
    .card h2{margin:0 0 16px;font-size:1.2rem;color:#333;display:flex;align-items:center;gap:8px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;align-items:center}
    .input{padding:10px 12px;border-radius:8px;border:1px solid #ddd;width:100%;font-size:0.95rem;margin-bottom:8px;transition:border .2s}
    .input:focus{outline:none;border-color:#0b74de;box-shadow:0 0 0 3px rgba(11,116,222,0.1)}
    textarea.input{resize:vertical;min-height:80px;font-family:inherit}
    .task{display:flex;align-items:flex-start;justify-content:space-between;padding:12px;border-bottom:1px solid #f0f0f0;transition:background .2s}
    .task:hover{background:#f9fcff}
    .task:last-child{border-bottom:none}
    .task-left{display:flex;gap:12px;align-items:flex-start;flex:1}
    .task input[type="checkbox"]{margin-top:4px;width:18px;height:18px;cursor:pointer}
    .task-content{flex:1}
    .task-title{font-weight:600;margin-bottom:4px}
    .task-desc{color:#666;font-size:0.9rem;margin-bottom:4px}
    .task-meta{font-size:0.85rem;color:#999}
    .task-actions{display:flex;gap:6px}
    .muted{color:#666;font-size:0.9rem}
    .status-indicator{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:6px;font-size:0.85rem;font-weight:600}
    .status-online{background:#d4edda;color:#155724}
    .status-offline{background:#f8d7da;color:#721c24}
    #cameraArea{margin-top:12px}
    #cameraPreview{max-width:100%;border-radius:8px;background:#000}
    #photoCanvas{display:none}
    .photo-preview{max-width:120px;border-radius:8px;margin-top:8px;border:2px solid #0b74de}
    .empty{text-align:center;padding:32px;color:#999}
    .result-msg{margin-top:12px;padding:10px;border-radius:6px;font-size:0.9rem}
    .result-success{background:#d4edda;color:#155724}
    .result-error{background:#f8d7da;color:#721c24}
    .result-info{background:#d1ecf1;color:#0c5460}
    .badge{display:inline-block;padding:3px 8px;background:#0b74de;color:white;border-radius:4px;font-size:0.8rem;margin-left:8px}
    @media(max-width:600px){
      header{flex-direction:column;align-items:flex-start}
      .controls{flex-direction:column;width:100%}
      .btn{width:100%;justify-content:center}
    }
  </style>
</head>
<body>
  <header>
    <h1>Task Manager</h1>
    <div class="header-actions">
      <button class="btn btn-small" id="installBtn" style="display:none">Instalar App</button>
      <div id="status" class="status-indicator status-online">Online</div>
      <a href="/" class="link">Ver SSR</a>
    </div>
  </header>

  <!-- Sección: Crear tarea -->
  <section class="card">
    <h2>Crear nueva tarea</h2>
    <input id="titleInput" class="input" placeholder="Título de la tarea" maxlength="100" required>
    <textarea id="descInput" class="input" placeholder="Descripción (opcional)" maxlength="500"></textarea>
    
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="getLocation" class="btn btn-secondary">Ubicación</button>
      <button id="openCamera" class="btn btn-secondary">Foto</button>
      <button id="createTask" class="btn btn-success">Crear tarea</button>
    </div>
    
    <div id="cameraArea">
      <video id="cameraPreview" autoplay playsinline style="display:none"></video>
      <canvas id="photoCanvas"></canvas>
      <img id="photoPreview" class="photo-preview" style="display:none">
    </div>
    
    <div id="createResult"></div>
  </section>

  <!-- Sección: Lista de tareas -->
  <section class="card">
    <h2>Mis tareas<span id="taskCount" class="badge">0</span></h2>
    <div class="controls">
      <button id="syncBtn" class="btn">Sincronizar</button>
      <button id="clearAll" class="btn btn-secondary">Limpiar todo</button>
      <div class="muted" id="syncStatus"></div>
    </div>
    <div id="tasksList"></div>
  </section>

  <!-- Sección: Notificaciones -->
  <section class="card">
    <h2>Notificaciones & Push</h2>
    <div class="controls">
      <button id="notifBtn" class="btn"> Pedir permiso de notificaciones</button>
      <button id="subscribePush" class="btn btn-secondary">Suscribirse a Push</button>
      <button id="triggerServerPush" class="btn btn-secondary">Test: Enviar Push desde server</button>
    </div>
    <div id="pushResult"></div>
  </section>

  <script src="/public/app.js"></script>
</body>
</html>